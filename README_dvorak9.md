# Dvorak-9 scorer: Theory, implementation, and empirical validation
A comprehensive implementation and validation of August Dvorak's 9 evaluation criteria from his 1936 work "Typewriter Keyboard" and patent. This project bridges theoretical keyboard design principles with modern empirical analysis using real typing speed data and subjective comfort ratings.

**Repository**: https://github.com/binarybottle/dvorak9-scorer.git  
**Author**: Arno Klein (arnoklein.info)  
**License**: MIT License (see LICENSE)

## Dvorak's 9 evaluation criteria (0-1 scale, higher = better):
1. Hands - favor alternating hands over same hand sequences
2. Fingers - avoid same finger repetition  
3. Skip fingers - favor non-adjacent fingers over adjacent
4. Don't cross home - avoid crossing over the home row
5. Same row - favor typing within the same row
6. Home row - favor using the home row
7. Columns - favor fingers staying in their designated columns
8. Strum - favor inward rolls over outward rolls
9. Strong fingers - favor stronger fingers over weaker ones

## Three scoring approaches

### Pure Dvorak score
- Unweighted average of all 9 individual criteria
- No external dependencies; direct theoretical interpretation
- Simple arithmetic mean of criterion scores across layout bigrams

### Frequency-weighted score  
- English bigram frequency-weighted average of 9 criteria
- Accounts for how frequently bigrams actually occur in English text
- Frequency-weighted mean using English linguistic data

### Speed- or comfort-weighted score
- Frequency-weighted with speed or comfort combination weights from real data
- Accounts for real-world typing performance and user preferences
- Requires a speed or comfort weights CSV file

## Input

### Required files
- `input/letter_pair_frequencies_english.csv` - English bigram frequencies for linguistic weighting
- `input/key_pair_scores.csv` - Precomputed Dvorak-9 scores (generated by `generate_key_pair_scores.py`)

### Optional weight files
- `input/speed_weights.csv` - Speed weights
- `input/comfort_weights.csv` - Comfort weights

## Data sources

### Typing performance data
Real typing data from the 136M Keystrokes dataset:
- Correctly typed bigrams from correctly typed words only
- 32 standard keyboard keys (includes numbers, letters, punctuation)
- See [process_3.5M_keystrokes](https://github.com/binarybottle/process_3.5M_keystrokes)
- Dhakal et al. Observations on Typing from 136 Million Keystrokes. CHI 2018.

### Comfort rating data
Subjective comfort preferences from typing preference studies:
- [typing_preferences_to_comfort_scores](https://github.com/binarybottle/typing_preferences_to_comfort_scores)
- Extended to 32 keys from the original 24 keys:
  if a bigram contains a key outside the home blocks, 
  assign it a score just above the highest score for a hurdle (VR)

### Linguistic frequency data
English bigram frequencies for frequency weighting and linguistic control

## Scripts overview

### Scoring
#### `dvorak9_scorer.py`
Calculate Dvorak-9 scores for keyboard layouts using frequency-weighted evaluation
- **Three scoring approaches**: Pure Dvorak, frequency-weighted, and empirically-weighted
- Supports both speed-based and comfort-based empirical weights
- Fast lookup-based scoring using precomputed key-pair scores
- Frequency-weighted evaluation using English bigram patterns
- Multiple output formats (human-readable, CSV, compact score lists)

**Usage**:
```bash
# Basic scoring (shows all three approaches)
python dvorak9_scorer.py --letters "etaoinshrlcu" --qwerty_keys "FDESGJWXRTYZ"

# Speed-optimized scoring
python dvorak9_scorer.py --letters "etaoinshrlcu" --qwerty_keys "FDESGJWXRTYZ" \
  --weights "input/speed_weights.csv"

# Comfort-optimized scoring
python dvorak9_scorer.py --letters "etaoinshrlcu" --qwerty_keys "FDESGJWXRTYZ" \
  --weights "input/comfort_weights.csv"

# All scores output (pure + frequency-weighted + empirical + 9 individual)
python dvorak9_scorer.py --letters "etaoinshrlcu" --qwerty_keys "FDESGJWXRTYZ" --all-scores

# CSV output with all metrics
python dvorak9_scorer.py --letters "etaoinshrlcu" --qwerty_keys "FDESGJWXRTYZ" --csv
```

#### `generate_key_pair_scores.py`
Precompute Dvorak-9 scores for all possible key-pair combinations
- Generates scores for all 32×32 = 1,024 key-pair combinations
- Creates fast lookup table for frequency-weighted scoring
- Must be run once before using the main scorer

**Usage**:
```bash
python generate_key_pair_scores.py
```

### Empirical weight generation
#### `generate_combinations_weights_from_speed.py`
Generate empirical weights from typing speed data
- Analyzes 136M+ keystroke dataset for speed correlations
- Includes linguistic frequency adjustment
- Negative correlations indicate speed benefits (faster typing)
- FDR-corrected statistical significance testing

#### `generate_combinations_weights_from_comfort.py`
Generate empirical weights from comfort preference data
- Analyzes subjective comfort ratings from typing studies
- Positive correlations indicate comfort benefits
- Extended coverage via empirical extrapolation
- FDR-corrected statistical significance testing

### Validation and testing
#### `validate_scorer.py`
Comprehensive validation of scoring implementation
- Tests all possible key-pair combinations
- Validates expected criterion behaviors
- Tests both frequency-weighted and empirically-weighted scoring
- Outputs diagnostic CSV files for analysis

**Usage**:
```bash
# Test basic scoring
python validate_scorer.py

# Test with speed weights
python validate_scorer.py --weights input/speed_weights.csv

# Test with comfort weights
python validate_scorer.py --weights input/comfort_weights.csv
```

## Scoring approach comparison

| Aspect | Pure Dvorak | Frequency-weighted | Speed-weighted | Comfort-weighted |
|--------|-------------|-------------------|------------------------------|-------------------------------|
| **Data source** | Dvorak theory only | English bigram frequencies | 136M keystroke dataset | Subjective preference ratings |
| **Calculation** | Simple average of 9 criteria | Frequency-weighted average | Empirical combination weights | Empirical combination weights |
| **Dependencies** | key-pair scores only | Frequency file + key-pair scores | Speed weights + frequency + key-pairs | Comfort weights + frequency + key-pairs |
| **Correlation direction** | N/A (theoretical) | N/A (frequency weighting) | Negative = good (faster) | Positive = good (more comfortable) |
| **Language adjustment** | No | Yes (English patterns) | Yes (with frequency control) | Yes (English patterns) |
| **Coverage** | All layouts | All layouts | Empirically validated combinations | Empirically validated combinations |
| **Use case** | Pure theory testing | Language-adjusted theory | Performance optimization | Ergonomic optimization |
| **Interpretability** | High (direct Dvorak scores) | High (frequency-adjusted Dvorak) | Medium (empirically weighted) | Medium (empirically weighted) |

### Implementation features
- **Frequency-based evaluation**: Uses English bigram frequencies rather than arbitrary text input for consistent, reproducible scoring
- **Precomputed lookup**: 32×32 key-pair score matrix enables fast evaluation without on-demand computation
- **Letter-only analysis**: Automatically filters to alphabetic characters, ignoring punctuation
- **Multi-score output**: Shows pure, frequency-weighted, and empirically-weighted scores side-by-side
- **Empirical validation**: Uses combination-specific weights derived from real performance data

### Statistical methods
- **Frequency weighting**: English bigram frequency-weighted averaging
- **Multiple testing correction**: Benjamini-Hochberg FDR correction for empirical weight validation
- **Correlation analysis**: Spearman rank correlation (robust to outliers)
- **Coverage extension**: Empirical extrapolation for complete keyboard coverage

## Integration examples

### Python API usage
```python
from dvorak9_scorer import Dvorak9Scorer

# Create layout mapping
layout_mapping = {'e': 'D', 't': 'K', 'a': 'A', 'o': 'S'}

# Basic frequency-weighted scoring
scorer = Dvorak9Scorer(layout_mapping)
results = scorer.calculate_scores()

print(f"Pure Dvorak score: {results['pure_dvorak_score']:.3f}")
print(f"Frequency-weighted score: {results['frequency_weighted_score']:.3f}")
print(f"Primary score: {results['layout_score']:.3f}")

# Speed-optimized scoring
speed_scorer = Dvorak9Scorer(
    layout_mapping, 
    weights="input/speed_weights.csv"
)
speed_results = speed_scorer.calculate_scores()

# Comfort-optimized scoring
comfort_scorer = Dvorak9Scorer(
    layout_mapping,
    weights="input/comfort_weights.csv"
)
comfort_results = comfort_scorer.calculate_scores()

print(f"Speed-optimized score: {speed_results['layout_score']:.3f}")
print(f"Comfort-optimized score: {comfort_results['layout_score']:.3f}")
```

### Comparing individual criteria
```python
# Get detailed breakdown showing pure vs frequency-weighted for each criterion
results = scorer.calculate_scores()

print("Individual Criterion Comparison:")
for criterion in ['hands', 'fingers', 'skip_fingers', 'dont_cross_home', 
                  'same_row', 'home_row', 'columns', 'strum', 'strong_fingers']:
    pure = results['pure_individual_scores'][criterion]
    freq = results['individual_scores'][criterion]
    print(f"{criterion:15}: pure={pure:.3f}, freq-weighted={freq:.3f}, diff={freq-pure:+.3f}")
```

## Setup and installation

### Prerequisites
- Python 3.7+
- Required Python packages: `csv`, `argparse`, `collections`, `pathlib`

### Initial setup
1. Clone the repository
2. Generate precomputed key-pair scores:
   ```bash
   python generate_key_pair_scores.py
   ```
3. Ensure required data files are in the `input/` directory:
   - `letter_pair_frequencies_english.csv`
   - `speed_weights.csv` (optional)
   - `comfort_weights.csv` (optional)
